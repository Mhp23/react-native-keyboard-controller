{"version":3,"names":["React","useContext","useMemo","useRef","Animated","StyleSheet","Reanimated","useEvent","useHandler","useSharedValue","KeyboardControllerView","useResizeMode","KeyboardControllerViewAnimated","createAnimatedComponent","defaultContext","animated","progress","Value","height","reanimated","value","KeyboardContext","createContext","useKeyboardAnimation","context","useReanimatedKeyboardAnimation","useAnimatedKeyboardHandler","handlers","dependencies","doDependenciesDiffer","event","onKeyboardMove","eventName","endsWith","styles","create","container","flex","hidden","display","position","KeyboardProvider","children","statusBarTranslucent","current","progressSV","heightSV","style","transform","translateX","translateY","nativeEvent","useNativeDriver","handler"],"sources":["animated.tsx"],"sourcesContent":["import React, { useContext, useMemo, useRef } from 'react';\nimport { Animated, StyleSheet, ViewStyle } from 'react-native';\nimport Reanimated, {\n  useEvent,\n  useHandler,\n  useSharedValue,\n} from 'react-native-reanimated';\nimport {\n  EventWithName,\n  KeyboardControllerProps,\n  KeyboardControllerView,\n  NativeEvent,\n  useResizeMode,\n} from './native';\n\nconst KeyboardControllerViewAnimated = Reanimated.createAnimatedComponent(\n  Animated.createAnimatedComponent(\n    KeyboardControllerView\n  ) as React.FC<KeyboardControllerProps>\n);\n\ntype AnimatedContext = {\n  progress: Animated.Value;\n  height: Animated.Value;\n};\ntype ReanimatedContext = {\n  progress: Reanimated.SharedValue<number>;\n  height: Reanimated.SharedValue<number>;\n};\ntype KeyboardAnimationContext = {\n  animated: AnimatedContext;\n  reanimated: ReanimatedContext;\n};\nconst defaultContext: KeyboardAnimationContext = {\n  animated: {\n    progress: new Animated.Value(0),\n    height: new Animated.Value(0),\n  },\n  reanimated: {\n    progress: { value: 0 },\n    height: { value: 0 },\n  },\n};\nexport const KeyboardContext = React.createContext(defaultContext);\n\nexport const useKeyboardAnimation = (): AnimatedContext => {\n  useResizeMode();\n  const context = useContext(KeyboardContext);\n\n  return context.animated;\n};\n\nexport const useReanimatedKeyboardAnimation = (): ReanimatedContext => {\n  useResizeMode();\n  const context = useContext(KeyboardContext);\n\n  return context.reanimated;\n};\n\nfunction useAnimatedKeyboardHandler<TContext extends Record<string, unknown>>(\n  handlers: {\n    onKeyboardMove?: (e: NativeEvent, context: TContext) => void;\n  },\n  dependencies?: ReadonlyArray<unknown>\n) {\n  const { context, doDependenciesDiffer } = useHandler(handlers, dependencies);\n\n  return useEvent(\n    (event: EventWithName<NativeEvent>) => {\n      'worklet';\n      const { onKeyboardMove } = handlers;\n\n      if (onKeyboardMove && event.eventName.endsWith('onKeyboardMove')) {\n        onKeyboardMove(event, context);\n      }\n    },\n    ['onKeyboardMove'],\n    doDependenciesDiffer\n  );\n}\n\ntype Styles = {\n  container: ViewStyle;\n  hidden: ViewStyle;\n};\n\nexport const styles = StyleSheet.create<Styles>({\n  container: {\n    flex: 1,\n  },\n  hidden: {\n    display: 'none',\n    position: 'absolute',\n  },\n});\n\ntype KeyboardProviderProps = {\n  children: React.ReactNode;\n  /**\n   * Set the value to `true`, if you use translucent status bar on Android.\n   * If you already control status bar translucency via `react-native-screens`\n   * or `StatusBar` component from `react-native`, you can ignore it.\n   * Defaults to `false`.\n   *\n   * @see https://github.com/kirillzyusko/react-native-keyboard-controller/issues/14\n   * @platform android\n   */\n  statusBarTranslucent?: boolean;\n};\n\nexport const KeyboardProvider = ({\n  children,\n  statusBarTranslucent,\n}: KeyboardProviderProps) => {\n  const progress = useRef(new Animated.Value(0)).current;\n  const height = useRef(new Animated.Value(0)).current;\n  const progressSV = useSharedValue(0);\n  const heightSV = useSharedValue(0);\n  const context = useMemo(\n    () => ({\n      animated: { progress: progress, height: height },\n      reanimated: { progress: progressSV, height: heightSV },\n    }),\n    []\n  );\n  const style = useMemo(\n    () => [\n      styles.hidden,\n      { transform: [{ translateX: height }, { translateY: progress }] },\n    ],\n    []\n  );\n\n  const onKeyboardMove = useMemo(\n    () =>\n      Animated.event(\n        [\n          {\n            nativeEvent: {\n              progress,\n              height,\n            },\n          },\n        ],\n        { useNativeDriver: true }\n      ),\n    []\n  );\n\n  const handler = useAnimatedKeyboardHandler(\n    {\n      onKeyboardMove: (event: NativeEvent) => {\n        'worklet';\n        progressSV.value = event.progress;\n        heightSV.value = event.height;\n      },\n    },\n    []\n  );\n\n  return (\n    <KeyboardContext.Provider value={context}>\n      <KeyboardControllerViewAnimated\n        onKeyboardMoveReanimated={handler}\n        onKeyboardMove={onKeyboardMove}\n        statusBarTranslucent={statusBarTranslucent}\n        style={styles.container}\n      >\n        <>\n          <Animated.View\n            // we are using this small hack, because if the component (where\n            // animated value has been used) is unmounted, then animation will\n            // stop receiving events (seems like it's react-native optimization).\n            // So we need to keep a reference to the animated value, to keep it's\n            // always mounted (keep a reference to an animated value).\n            //\n            // To test why it's needed, try to open screen which consumes Animated.Value\n            // then close it and open it again (for example 'Animated transition').\n            style={style}\n          />\n          {children}\n        </>\n      </KeyboardControllerViewAnimated>\n    </KeyboardContext.Provider>\n  );\n};\n"],"mappings":"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"}