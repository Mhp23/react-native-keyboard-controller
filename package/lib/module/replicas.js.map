{"version":3,"sources":["replicas.ts"],"names":["useRef","useEffect","useMemo","Animated","Easing","Keyboard","Platform","runOnUI","useAnimatedReaction","useDerivedValue","useSharedValue","useWorkletCallback","withSpring","useReanimatedKeyboardAnimation","AndroidSoftInputModes","KeyboardController","availableOSEventType","OS","defaultAndroidEasing","bezier","useKeyboardAnimationReplica","height","Value","progress","animation","current","setInputMode","SOFT_INPUT_ADJUST_RESIZE","setDefaultMode","listener","addListener","e","timing","toValue","endCoordinates","duration","easing","useNativeDriver","start","remove","IOS_SPRING_CONFIG","damping","stiffness","mass","overshootClamping","restDisplacementThreshold","restSpeedThreshold","useReanimatedKeyboardAnimationReplica","heightEvent","value","handler","_height","_keyboardHeight","result","_previousResult","_previousKeyboardHeight","show","hide","useGradualKeyboardAnimation"],"mappings":"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","sourcesContent":["import { useRef, useEffect, useMemo } from 'react';\nimport { Animated, Easing, Keyboard, Platform } from 'react-native';\nimport {\n  runOnUI,\n  useAnimatedReaction,\n  useDerivedValue,\n  useSharedValue,\n  useWorkletCallback,\n  withSpring,\n} from 'react-native-reanimated';\nimport { useReanimatedKeyboardAnimation } from './animated';\n\nimport { AndroidSoftInputModes, KeyboardController } from './native';\n\nconst availableOSEventType = Platform.OS === 'ios' ? 'Will' : 'Did';\n\n// cubic-bezier(.17,.67,.34,.94)\nexport const defaultAndroidEasing = Easing.bezier(0.4, 0.0, 0.2, 1);\ntype KeyboardAnimation = {\n  progress: Animated.Value;\n  height: Animated.Value;\n};\n\n/**\n * An experimental implementation of tracing keyboard appearance.\n * Switch an input mode to adjust resize mode. In this case all did* events\n * are triggering before keyboard appears, and using some approximations\n * it tries to mimicries a native transition.\n *\n * @returns {Animated.Value}\n */\nexport const useKeyboardAnimationReplica = (): KeyboardAnimation => {\n  const height = useRef(new Animated.Value(0));\n  const progress = useRef(new Animated.Value(0));\n  const animation = useMemo(\n    () => ({\n      height: height.current,\n      progress: progress.current,\n    }),\n    []\n  );\n\n  useEffect(() => {\n    KeyboardController.setInputMode(\n      AndroidSoftInputModes.SOFT_INPUT_ADJUST_RESIZE\n    );\n\n    return () => KeyboardController.setDefaultMode();\n  }, []);\n  useEffect(() => {\n    const listener = Keyboard.addListener(\n      `keyboard${availableOSEventType}Show`,\n      (e) => {\n        Animated.timing(height.current, {\n          toValue: -e.endCoordinates.height,\n          duration: e.duration !== 0 ? e.duration : 300,\n          easing: Easing.bezier(0.4, 0.0, 0.2, 1),\n          useNativeDriver: true,\n        }).start();\n\n        return () => listener.remove();\n      }\n    );\n  }, []);\n  useEffect(() => {\n    const listener = Keyboard.addListener(\n      `keyboard${availableOSEventType}Hide`,\n      (e) => {\n        Animated.timing(height.current, {\n          toValue: 0,\n          duration: e.duration !== 0 ? e.duration : 300,\n          easing: Easing.bezier(0.4, 0.0, 0.2, 1),\n          useNativeDriver: true,\n        }).start();\n\n        return () => listener.remove();\n      }\n    );\n  }, []);\n\n  return animation;\n};\n\nconst IOS_SPRING_CONFIG = {\n  damping: 500,\n  stiffness: 1000,\n  mass: 3,\n  overshootClamping: true,\n  restDisplacementThreshold: 10,\n  restSpeedThreshold: 10,\n};\n\n/**\n * A close replica to native iOS keyboard animation. The problem is that\n * iOS (unlike Android) can not fire events for each keyboard frame movement.\n * As a result we can not get gradual values (for example, for progress it always\n * will be 1 or 0). So if you want to rely on gradual values you will need to use\n * this replica.\n *\n * The transition is hardcoded and may vary from one to another OS versions. But it\n * seems like last time it has been changed in iOS 7. Since RN supports at least iOS\n * 11 it doesn't make sense to replicate iOS 7 behavior. If it changes in next OS\n * versions, then this implementation should be revisited and reflect necessary changes.\n *\n * @returns {height, progress} - animated values\n */\nexport const useReanimatedKeyboardAnimationReplica = () => {\n  const height = useSharedValue(0);\n  const heightEvent = useSharedValue(0);\n\n  const progress = useDerivedValue(() => height.value / heightEvent.value);\n\n  const handler = useWorkletCallback((_height: number) => {\n    heightEvent.value = _height;\n  }, []);\n\n  useAnimatedReaction(\n    () => ({\n      _keyboardHeight: heightEvent.value,\n    }),\n    (result, _previousResult) => {\n      const { _keyboardHeight } = result;\n      const _previousKeyboardHeight = _previousResult?._keyboardHeight;\n\n      if (_keyboardHeight !== _previousKeyboardHeight) {\n        height.value = withSpring(_keyboardHeight, IOS_SPRING_CONFIG);\n      }\n    },\n    []\n  );\n\n  useEffect(() => {\n    const show = Keyboard.addListener('keyboardWillShow', (e) => {\n      runOnUI(handler)(-e.endCoordinates.height);\n    });\n    const hide = Keyboard.addListener('keyboardWillHide', () => {\n      runOnUI(handler)(0);\n    });\n\n    return () => {\n      show.remove();\n      hide.remove();\n    };\n  }, []);\n\n  return { height, progress };\n};\n\nexport const useGradualKeyboardAnimation =\n  Platform.OS === 'ios'\n    ? useReanimatedKeyboardAnimationReplica\n    : useReanimatedKeyboardAnimation;\n"]}